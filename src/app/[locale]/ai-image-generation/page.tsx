"use client";

import React, { useState, useEffect } from 'react';
import { useRouter } from '../../../../navigation';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Loader2, Download, Image as ImageIcon, Sparkles, HelpCircle } from 'lucide-react';
import { toast } from '@/components/ui/use-toast';
import { useAuth } from '@/lib/auth/auth-context';
import { useAuthCheck } from '@/hooks/useAuthCheck';
import { useIndustryPresets } from '@/hooks/useIndustryPresets';
import { LoginReminderModal } from '@/components/ui/login-reminder-modal';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';
import { validateFormData, sanitizeFormData, requestRateLimiter } from '@/lib/security/frontend-validation';

// é£æ ¼é€‰é¡¹
const STYLE_OPTIONS = [
  { value: 'é«˜çº§æç®€', label: 'é«˜çº§æç®€' },
  { value: 'å‡ ä½•å‘é‡', label: 'å‡ ä½•å‘é‡' },
  { value: 'å‰ªè´´æŠ¥æ‹¼æ¥', label: 'å‰ªè´´æŠ¥æ‹¼æ¥' },
  { value: 'èåˆï¼ˆå‰ªè´´æŠ¥+å‡ ä½•ï¼‰', label: 'èåˆï¼ˆå‰ªè´´æŠ¥+å‡ ä½•ï¼‰' },
  { value: 'æ­£é¢ç‰¹å†™', label: 'æ­£é¢ç‰¹å†™' },
  { value: 'æ—¶å°šæ‚å¿—', label: 'æ—¶å°šæ‚å¿—' },
  { value: 'è½¬å‘æµ·æŠ¥', label: 'è½¬å‘æµ·æŠ¥' },
  { value: 'å¤šæ–‡åˆ—è¡¨', label: 'å¤šæ–‡åˆ—è¡¨' },
  { value: 'ç½‘æ ¼å¤§æ–‡æœ¬', label: 'ç½‘æ ¼å¤§æ–‡æœ¬' }
];

// å°ºå¯¸é€‰é¡¹
const SIZE_OPTIONS = [
  { value: '1:1', label: '1:1 (æ­£æ–¹å½¢)' },
  { value: '4:3', label: '4:3 (æ¨ªå±)' },
  { value: '3:4', label: '3:4 (ç«–å±)' },
  { value: '16:9', label: '16:9 (å®½å±)' },
  { value: '9:16', label: '9:16 (ç«–å±å®½å±)' }
];

export default function AIImageGenerationPage() {
  const router = useRouter();
  const { authState } = useAuth();
  const { isAuthenticated, credits } = authState;
  const { withAuthCheck, showLoginModal, setShowLoginModal } = useAuthCheck();
  const { getFieldPresets, userIndustry } = useIndustryPresets();

  const [formData, setFormData] = useState({
    background: '',
    subject: '',
    mainTitle: '',
    subtitle: '',
    style: '',
    size: ''
  });

  const [isGenerating, setIsGenerating] = useState(false);
  const [generatedImages, setGeneratedImages] = useState<string[]>([]);
  const [currentImageIndex, setCurrentImageIndex] = useState(0);
  const [creditCost, setCreditCost] = useState(10); // ä¸´æ—¶ç¡¬ç¼–ç ï¼Œåº”è¯¥ä»æ•°æ®åº“è·å–
  const [isDownloading, setIsDownloading] = useState(false);
  const [showStylePreview, setShowStylePreview] = useState(false);

  // è·å–è§’è‰²é¢„è®¾é€‰é¡¹
  const rolePresets = getFieldPresets('xiaohongshu-post-generation', 'role') || [];

  // å¤„ç†é¢„è®¾é€‰é¡¹ç‚¹å‡»
  const handlePresetClick = (presetText: string) => {
    setFormData(prev => ({
      ...prev,
      subject: presetText
    }));
  };

  // æ ¹æ®å°ºå¯¸æ¯”ä¾‹è®¡ç®—é¢„è§ˆå®¹å™¨çš„æ ·å¼
  const getPreviewContainerStyle = () => {
    if (!formData.size) return {};
    
    const aspectRatios: Record<string, string> = {
      '1:1': 'aspect-square',
      '4:3': 'aspect-[4/3]',
      '3:2': 'aspect-[3/2]',
      '3:4': 'aspect-[3/4]',
      '2:3': 'aspect-[2/3]',
      '16:9': 'aspect-video',
      '9:16': 'aspect-[9/16]',
      '21:9': 'aspect-[21/9]'
    };
    
    return {
      className: aspectRatios[formData.size] || 'aspect-square'
    };
  };

  // è·å–ç§¯åˆ†æˆæœ¬
  useEffect(() => {
    const fetchCreditCost = async () => {
      try {
        console.log('ğŸ”„ æ­£åœ¨è·å–ç§¯åˆ†æˆæœ¬...');
        // ä½¿ç”¨æ–°çš„ç®€åŒ–API
        const response = await fetch('/api/credits/image-cost');
        console.log('ğŸ“¡ APIå“åº”çŠ¶æ€:', response.status);
        
        if (response.ok) {
          const data = await response.json();
          console.log('ğŸ“Š APIè¿”å›æ•°æ®:', data);
          
          if (data.success && data.cost) {
            console.log('âœ… è®¾ç½®ç§¯åˆ†æˆæœ¬:', data.cost);
            setCreditCost(data.cost);
          } else {
            console.warn('âš ï¸ APIè¿”å›æ•°æ®æ ¼å¼ä¸æ­£ç¡®:', data);
            // å¦‚æœAPIå¤±è´¥ï¼Œä½¿ç”¨ç¡¬ç¼–ç å€¼
            setCreditCost(10);
          }
        } else {
          console.error('âŒ APIè¯·æ±‚å¤±è´¥:', response.status, response.statusText);
          // å¦‚æœAPIå¤±è´¥ï¼Œä½¿ç”¨ç¡¬ç¼–ç å€¼
          setCreditCost(10);
        }
      } catch (error) {
        console.error('âŒ è·å–ç§¯åˆ†æˆæœ¬å¤±è´¥:', error);
        // å¦‚æœAPIå¤±è´¥ï¼Œä½¿ç”¨ç¡¬ç¼–ç å€¼
        setCreditCost(10);
      }
    };

    fetchCreditCost();
  }, []);

  const handleInputChange = (field: string, value: string) => {
    setFormData(prev => ({
      ...prev,
      [field]: value
    }));
  };

  const handleGenerate = async () => {
    // 1. è·å–è¡Œä¸šé¢„è®¾
    const backgroundPresets = getFieldPresets('ai-image-generation', 'background') || [];
    const subjectPresets = getFieldPresets('ai-image-generation', 'subject') || [];
    const mainTitlePresets = getFieldPresets('ai-image-generation', 'mainTitle') || [];
    const subtitlePresets = getFieldPresets('ai-image-generation', 'subtitle') || [];

    // 2. å¦‚æœå­—æ®µä¸ºç©ºï¼Œä½¿ç”¨è¡Œä¸šé¢„è®¾
    const finalFormData = {
      background: formData.background || (backgroundPresets.length > 0 ? backgroundPresets[0].chinese : 'æ¸©é¦¨çš„å®¶åº­ç¯å¢ƒ'),
      subject: formData.subject || (subjectPresets.length > 0 ? subjectPresets[0].chinese : 'ä¸“ä¸šæœåŠ¡äººå‘˜'),
      mainTitle: formData.mainTitle || (mainTitlePresets.length > 0 ? mainTitlePresets[0].chinese : 'ä¸“ä¸šæœåŠ¡'),
      subtitle: formData.subtitle || (subtitlePresets.length > 0 ? subtitlePresets[0].chinese : 'ç”¨å¿ƒæœåŠ¡ï¼Œå€¼å¾—ä¿¡èµ–'),
      style: formData.style || 'é«˜çº§æç®€',
      size: formData.size || '1:1'
    };

    // 3. å®‰å…¨éªŒè¯ï¼šæ£€æŸ¥è¯·æ±‚é¢‘ç‡
    const userId = authState.user?.id || 'anonymous';
    if (!requestRateLimiter.canMakeRequest(userId, 3, 60000)) { // 1åˆ†é’Ÿå†…æœ€å¤š3æ¬¡è¯·æ±‚
      toast({
        title: "è¯·æ±‚è¿‡äºé¢‘ç¹",
        description: "è¯·ç¨åå†è¯•ï¼Œé¿å…é¢‘ç¹è¯·æ±‚",
        variant: "destructive"
      });
      return;
    }

    // 4. è¡¨å•æ•°æ®å®‰å…¨éªŒè¯
    const formValidation = validateFormData(finalFormData);
    if (!formValidation.isValid) {
      toast({
        title: "è¾“å…¥å†…å®¹ä¸å®‰å…¨",
        description: formValidation.error,
        variant: "destructive"
      });
      return;
    }

    // 5. æ¸…ç†è¡¨å•æ•°æ®
    const sanitizedFormData = sanitizeFormData(finalFormData);

    // ä½¿ç”¨withAuthCheckåŒ…è£…ç”Ÿæˆé€»è¾‘
    withAuthCheck(async () => {
      if (!credits || credits.balance < creditCost) {
        toast({
          title: "ç§¯åˆ†ä¸è¶³",
          description: `ç”Ÿæˆå›¾ç‰‡éœ€è¦${creditCost}ç§¯åˆ†ï¼Œå½“å‰ä½™é¢${credits?.balance || 0}ç§¯åˆ†ï¼Œè¯·å…ˆå……å€¼`,
          variant: "destructive"
        });
        return;
      }

      setIsGenerating(true);

      try {
        const response = await fetch('/api/generateImage', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            background: sanitizedFormData.background,
            subject: sanitizedFormData.subject,
            mainTitle: sanitizedFormData.mainTitle,
            subtitle: sanitizedFormData.subtitle,
            style: sanitizedFormData.style || 'é«˜çº§æç®€',
            size: sanitizedFormData.size || '1:1'
          }),
        });

        if (!response.ok) {
          throw new Error('ç”Ÿæˆå¤±è´¥');
        }

        const data = await response.json();
        
        if (data.success && data.images) {
          setGeneratedImages(data.images);
          setCurrentImageIndex(0);
          toast({
            title: "ç”ŸæˆæˆåŠŸ",
            description: "å›¾ç‰‡å·²ç”Ÿæˆå®Œæˆ",
          });
        } else {
          throw new Error(data.message || 'ç”Ÿæˆå¤±è´¥');
        }
      } catch (error) {
        console.error('ç”Ÿæˆå›¾ç‰‡å¤±è´¥:', error);
        toast({
          title: "ç”Ÿæˆå¤±è´¥",
          description: "è¯·ç¨åé‡è¯•æˆ–è”ç³»å®¢æœ",
          variant: "destructive"
        });
      } finally {
        setIsGenerating(false);
      }
    }, window.location.pathname + window.location.search);
  };

  const handleDownload = async (imageUrl: string) => {
    if (isDownloading) return; // é˜²æ­¢é‡å¤ä¸‹è½½
    
    setIsDownloading(true);
    
    try {
      // æ˜¾ç¤ºä¸‹è½½å¼€å§‹æç¤º
      toast({
        title: "å¼€å§‹ä¸‹è½½",
        description: "æ­£åœ¨å‡†å¤‡å›¾ç‰‡æ–‡ä»¶...",
      });

      // è·å–å›¾ç‰‡æ•°æ®
      const response = await fetch(imageUrl);
      if (!response.ok) {
        throw new Error('Failed to fetch image');
      }
      
      const blob = await response.blob();
      
      // åˆ›å»ºä¸‹è½½é“¾æ¥
      const url = window.URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `ai-generated-image-${Date.now()}.png`;
      
      // è§¦å‘ä¸‹è½½
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      // æ¸…ç†ä¸´æ—¶URL
      window.URL.revokeObjectURL(url);
      
      // æ˜¾ç¤ºä¸‹è½½æˆåŠŸæç¤º
      toast({
        title: "ä¸‹è½½æˆåŠŸ",
        description: "å›¾ç‰‡å·²ä¿å­˜åˆ°æœ¬åœ°",
      });
    } catch (error) {
      console.error('Download failed:', error);
      toast({
        title: "ä¸‹è½½å¤±è´¥",
        description: "è¯·ç¨åé‡è¯•æˆ–è”ç³»å®¢æœ",
        variant: "destructive"
      });
    } finally {
      setIsDownloading(false);
    }
  };

  const currentImage = generatedImages[currentImageIndex];

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 pt-16">
      <div className="container mx-auto px-4">

        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-7xl mx-auto">
          {/* å·¦ä¾§ï¼šå›¾ç‰‡é¢„è§ˆåŒºåŸŸ */}
          <div className="space-y-6">
            <Card className="bg-white/80 backdrop-blur-sm border-0 shadow-xl">
              <CardHeader>
                <CardTitle className="flex items-center justify-between text-xl font-bold text-gray-800">
                  <div className="flex items-center">
                    <ImageIcon className="w-6 h-6 mr-2 text-purple-600" />
                    å›¾ç‰‡é¢„è§ˆ
                  </div>
                  {formData.size && (
                    <Badge variant="outline" className="text-sm">
                      {formData.size}
                    </Badge>
                  )}
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className={`bg-gray-100 rounded-xl overflow-hidden border-2 border-gray-200 ${getPreviewContainerStyle().className || 'aspect-square'}`}>
                  {currentImage ? (
                    <div className="relative w-full h-full">
                      <img 
                        src={currentImage} 
                        alt="Generated image"
                        className="w-full h-full object-contain"
                      />
                      {/* å›¾ç‰‡ä¸Šçš„æ ‡é¢˜è¦†ç›–å±‚ */}
                      <div className="absolute top-4 right-4 bg-white/90 backdrop-blur-sm rounded-lg p-3 max-w-xs">
                        <h3 className="font-bold text-lg text-gray-800 mb-1">
                          {formData.mainTitle}
                        </h3>
                        {formData.subtitle && (
                          <p className="text-sm text-gray-600">
                            {formData.subtitle}
                          </p>
                        )}
                      </div>
                    </div>
                  ) : isGenerating ? (
                    <div className="flex flex-col items-center justify-center h-full text-gray-400">
                      <Loader2 className="w-16 h-16 mb-4 animate-spin text-purple-600" />
                      <p className="text-lg font-medium text-purple-600">AI æ€è€ƒä¸­...</p>
                      <p className="text-sm">æ­£åœ¨ç”Ÿæˆæ‚¨çš„ä¸“å±å›¾ç‰‡</p>
                    </div>
                  ) : (
                    <div className="flex flex-col items-center justify-center h-full text-gray-400">
                      <ImageIcon className="w-16 h-16 mb-4" />
                      <p className="text-lg font-medium">æš‚æ— å›¾ç‰‡</p>
                      <p className="text-sm">å¡«å†™è¡¨å•åç‚¹å‡»ç”ŸæˆæŒ‰é’®</p>
                    </div>
                  )}
                </div>

                {/* å›¾ç‰‡å¯¼èˆªç‚¹ */}
                {generatedImages.length > 1 && (
                  <div className="flex justify-center space-x-2 mt-4">
                    {generatedImages.map((_, index) => (
                      <button
                        key={index}
                        onClick={() => setCurrentImageIndex(index)}
                        className={`w-3 h-3 rounded-full transition-colors ${
                          index === currentImageIndex 
                            ? 'bg-purple-600' 
                            : 'bg-gray-300 hover:bg-gray-400'
                        }`}
                      />
                    ))}
                  </div>
                )}

                {/* ä¸‹è½½æŒ‰é’® */}
                {currentImage && (
                  <div className="mt-4">
                    <Button
                      onClick={() => handleDownload(currentImage)}
                      disabled={isDownloading}
                      className="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-medium disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      {isDownloading ? (
                        <>
                          <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                          ä¸‹è½½ä¸­...
                        </>
                      ) : (
                        <>
                          <Download className="w-4 h-4 mr-2" />
                          ä¸‹è½½å›¾ç‰‡
                        </>
                      )}
                    </Button>
                    <p className="text-xs text-amber-600 mt-2 text-center">
                      âš ï¸ å›¾ç‰‡ä¸ºä¸´æ—¶æ–‡ä»¶ï¼Œè¯·åŠæ—¶ä¸‹è½½ä¿å­˜ï¼
                    </p>
                  </div>
                )}
              </CardContent>
            </Card>
          </div>

          {/* å³ä¾§ï¼šè¡¨å•åŒºåŸŸ */}
          <div className="space-y-6">
            <Card className="bg-white/80 backdrop-blur-sm border-0 shadow-xl">
              <CardHeader>
                <CardTitle className="flex items-center text-xl font-bold text-gray-800">
                  <Sparkles className="w-6 h-6 mr-2 text-purple-600" />
                  AI å‡ºå›¾è®¾ç½®
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                {/* ç¬¬ä¸€è¡Œï¼šå›¾ç‰‡èƒŒæ™¯å’Œå›¾ç‰‡ä¸»ä½“ */}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div className="space-y-2">
                    <div className="flex items-center justify-between">
                      <Label htmlFor="background" className="text-sm font-medium text-gray-700">
                        å›¾ç‰‡èƒŒæ™¯
                      </Label>
                      <div className="w-20 h-8"></div>
                    </div>
                    <Input
                      id="background"
                      placeholder="æ‰€å¤„çš„ç¯å¢ƒï¼ˆä¾‹å¦‚ï¼šåŠå…¬å®¤ï¼‰"
                      value={formData.background}
                      onChange={(e) => handleInputChange('background', e.target.value)}
                      className="border-gray-300 focus:border-purple-500 focus:ring-purple-500"
                    />
                  </div>
                  <div className="space-y-2">
                    <div className="flex items-center justify-between">
                      <Label htmlFor="subject" className="text-sm font-medium text-gray-700">
                        å›¾ç‰‡ä¸»ä½“
                      </Label>
                      {rolePresets.length > 0 && (
                        <Select onValueChange={(value) => handlePresetClick(value)}>
                          <SelectTrigger className="w-auto h-8 text-xs border-purple-200 focus:border-purple-500 focus:ring-purple-500">
                            <SelectValue placeholder="é€‰æ‹©è§’è‰²" />
                          </SelectTrigger>
                          <SelectContent>
                            {rolePresets.map((preset, index) => (
                              <SelectItem key={index} value={preset.chinese} className="text-xs">
                                {preset.chinese}
                              </SelectItem>
                            ))}
                          </SelectContent>
                        </Select>
                      )}
                    </div>
                    <Input
                      id="subject"
                      placeholder="å›¾ç‰‡çš„ä¸»è¦äººç‰©æˆ–ç‰©ä½“"
                      value={formData.subject}
                      onChange={(e) => handleInputChange('subject', e.target.value)}
                      className="border-gray-300 focus:border-purple-500 focus:ring-purple-500"
                    />
                  </div>
                </div>

                {/* ç¬¬äºŒè¡Œï¼šä¸»æ ‡é¢˜å’Œå°æ ‡é¢˜ */}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div className="space-y-2">
                    <Label htmlFor="mainTitle" className="text-sm font-medium text-gray-700">
                      ä¸»æ ‡é¢˜
                    </Label>
                    <Input
                      id="mainTitle"
                      placeholder="å»ºè®® 4-8å­—"
                      value={formData.mainTitle}
                      onChange={(e) => handleInputChange('mainTitle', e.target.value)}
                      className="border-gray-300 focus:border-purple-500 focus:ring-purple-500"
                    />
                  </div>
                  <div className="space-y-2">
                    <Label htmlFor="subtitle" className="text-sm font-medium text-gray-700">
                      å°æ ‡é¢˜
                    </Label>
                    <Input
                      id="subtitle"
                      placeholder="ä¸»æ ‡é¢˜è§£é‡Šæ–‡å­—ï¼Œå»ºè®® 10-20 å­—"
                      value={formData.subtitle}
                      onChange={(e) => handleInputChange('subtitle', e.target.value)}
                      className="border-gray-300 focus:border-purple-500 focus:ring-purple-500"
                    />
                  </div>
                </div>

                {/* ç¬¬ä¸‰è¡Œï¼šé£æ ¼å’Œå°ºå¯¸é€‰æ‹© */}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div className="space-y-2">
                    <div className="flex items-center gap-2">
                      <Label className="text-sm font-medium text-gray-700">
                        é£æ ¼
                      </Label>
                      <Dialog open={showStylePreview} onOpenChange={setShowStylePreview}>
                        <DialogTrigger asChild>
                          <button
                            type="button"
                            className="text-gray-400 hover:text-gray-600 transition-colors"
                            onClick={() => setShowStylePreview(true)}
                          >
                            <HelpCircle className="w-4 h-4" />
                          </button>
                        </DialogTrigger>
                        <DialogContent className="max-w-4xl max-h-[90vh] overflow-y-auto">
                          <DialogHeader>
                            <DialogTitle>é£æ ¼æ•ˆæœé¢„è§ˆ</DialogTitle>
                          </DialogHeader>
                          <div className="space-y-4">
                            <img 
                              src="/demo.png" 
                              alt="é£æ ¼æ•ˆæœé¢„è§ˆ" 
                              className="w-full h-auto rounded-lg border"
                            />
                            <p className="text-sm text-gray-600 text-center">
                              å›¾ç‰‡æ•ˆæœä»…ä¾›ç¤ºæ„å‚è€ƒï¼Œå…·ä½“ä»¥ AI åˆ›ä½œä¸ºå‡†
                            </p>
                          </div>
                        </DialogContent>
                      </Dialog>
                    </div>
                    <Select value={formData.style} onValueChange={(value) => handleInputChange('style', value)}>
                      <SelectTrigger className="border-gray-300 focus:border-purple-500 focus:ring-purple-500">
                        <SelectValue placeholder="é€‰æ‹©ç”»é¢é£æ ¼" />
                      </SelectTrigger>
                      <SelectContent>
                        {STYLE_OPTIONS.map((option) => (
                          <SelectItem key={option.value} value={option.value}>
                            {option.label}
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>
                  <div className="space-y-2">
                    <div className="flex items-center gap-2">
                      <Label className="text-sm font-medium text-gray-700">
                        å°ºå¯¸
                      </Label>
                    </div>
                    <Select value={formData.size} onValueChange={(value) => handleInputChange('size', value)}>
                      <SelectTrigger className="border-gray-300 focus:border-purple-500 focus:ring-purple-500">
                        <SelectValue placeholder="é€‰æ‹©å®½é«˜æ¯”" />
                      </SelectTrigger>
                      <SelectContent>
                        {SIZE_OPTIONS.map((option) => (
                          <SelectItem key={option.value} value={option.value}>
                            {option.label}
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                {/* ç”ŸæˆæŒ‰é’® */}
                <div className="pt-4">
                  <Button
                    onClick={handleGenerate}
                    disabled={isGenerating}
                    className="w-full h-14 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold text-lg shadow-lg hover:shadow-xl transition-all duration-300"
                  >
                    {isGenerating ? (
                      <>
                        <Loader2 className="w-5 h-5 mr-2 animate-spin" />
                        ç”Ÿæˆä¸­...
                      </>
                    ) : (
                      <>
                        <Sparkles className="w-5 h-5 mr-2" />
                        AI å‡ºå›¾
                        <Badge variant="secondary" className="ml-2 bg-white/20 text-white">
                          {creditCost} ç§¯åˆ†/å¼ 
                        </Badge>
                      </>
                    )}
                  </Button>
                </div>
              </CardContent>
            </Card>
          </div>
        </div>
      </div>
      
      {/* ç™»å½•æé†’å¼¹çª— */}
      <LoginReminderModal 
        open={showLoginModal} 
        onOpenChange={setShowLoginModal} 
      />
    </div>
  );
}
